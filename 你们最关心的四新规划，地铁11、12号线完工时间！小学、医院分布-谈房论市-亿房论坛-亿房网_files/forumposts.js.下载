"use strict";var forumpost={common:{autoaction:function(){$(".contenttext,.replyarea").find("img").each(function(){$(this).parent("p").attr("style")}),$(".contenttext,.replyarea").find("tr,td").removeAttr("nowrap").css("word-break","normal"),$(".editposts,.reward").click(function(a){a.stopPropagation(),$(this).find(".postitems,.rewardnum").stop(!0,!0).slideToggle()}),$(document).click(function(){$(".postitems,.rewardnum").each(function(){"none"!=$(this).css("display")&&$(this).slideUp()})});var a=window.location.href,b=function(a){var b="";switch(a){case"0":b="orderbynormal";break;case"1":b="orderbynew";break;case"3":b="orderbyscore"}$("."+b).addClass("active").siblings().removeClass("active"),$("."+b+" a").removeAttr("href")};if(a.indexOf("/forum-")>-1||a.indexOf("/thread-")>-1){var c=a.split("-");if(c.length>4){if(c[5]){var d=c[5].split(".")[0];b(d)}}else $(".orderbynormal").addClass("active").siblings().removeClass("active"),$(".orderbynormal a").removeAttr("href")}$(".star i").hover(function(){var a=$(this).index();$(".star i").css("background-position","-283px -363px");for(var b=0;b<=a;b++)$(".star"+(b+1)).css("background-position","-263px -363px");$(".starnum .leval").text(b),$(".starnum span").addClass("red")},function(){$(".star i").css("background-position","-243px -363px"),$(".starnum .leval").text(0),$(".starnum span").removeClass("red")}),$(".attention").hover(function(){$(this).hasClass("btn-gray")&&($(this).find("i").toggle(),$(this).find(".payattention").text("取消关注"))},function(){$(this).hasClass("btn-gray")&&($(this).find("i").toggle(),$(this).find(".payattention").text("已关注"))}),$(".reply").click(function(){$("html, body").animate({scrollTop:$(document).height()},300)}),$(".backtop").click(function(){$("body,html").animate({scrollTop:0},300)}),$(window).scroll(function(){$(this).scrollTop()>100?$(".backtop").fadeIn("slow"):$(".backtop").fadeOut("slow")});var e=function(){var a=null!=$(this).val()?$(this).val().replace(/\D/g,""):null;$(this).val(a),console.log(a)};$(".floornum,.pagenum").keyup(e),$(".orderby span").click(function(){$(this).addClass("active").siblings().removeClass("active")}),$(".replywrapper").each(function(a,b){$(this).find(".replylists li").size()>0&&($(this).show(),$(this).prev().find(".floorreply").text("收起"))}),$(".floorreply").click(function(){var a=$(this).parent().siblings(".replywrapper");switch(a.stop(!0,!0).slideToggle(),$(this).text()){case"回复":$(this).text("收起"),0==a.find(".replylists li").size()&&(a.find(".replyfloor").hide(),a.find(".replyedit").show(),a.find(".editarea").focus());break;case"收起":$(this).text("回复")}}),$("textarea.editarea").focus(function(){checkLoginFun(function(){})}),$(".replyfloorbtn").click(function(){var a=$(this);checkLoginFun(function(){var b=a.closest(".postcontent").find(".replyedit"),c=a.closest(".postcontent").find(".replyfloorbtn"),d=a.closest(".postcontent").find(".editarea"),e=d.val();a.closest(".replywrapper").find("textarea.editarea").attr("re_comment_rcid",""),a.closest(".replywrapper").find("textarea.editarea").attr("re_comment_userid",""),e?d.val("").focus():(b.stop(!0,!0).slideToggle(),c.stop(!0,!0).toggleClass("gray"),d.focus().val("")),a.closest(".postcontent").find(".authorname").val("")})}),$("body").on("click",".floorinreply",function(){var a=$(this);checkLoginFun(function(){var b=a.closest(".postcontent").find(".replyedit"),c=a.closest(".postcontent").find(".replyfloorbtn"),d=a.closest(".postcontent").find(".editarea"),e=a.closest(".floorcontent").find(".username").eq(0).text(),f=a.closest(".floorcontent").find(".username").eq(0).text();a.closest(".replywrapper").find(".authorname").val(f);var g=a.closest(".floorcontent").find(".floorcontenttext").attr("comment_id"),h=a.closest(".floorcontent").find("span[re_from_userid]").attr("re_from_userid");a.closest(".replywrapper").find("textarea.editarea").attr("re_comment_rcid",g),a.closest(".replywrapper").find("textarea.editarea").attr("re_comment_userid",h),b.slideDown(),c.addClass("gray"),d.focus().val("回复 "+e+" ：")})});var f=function(a,b){var c=a.prev(".userlist").height();a.prev(".userlist").animate({height:c*b+"px"},500),a.parent().find(".showmore").hide(),a.parent().find(".showless").css("margin-top",c*(b-1)+70+"px").show()};$(".showmore").click(function(){$(this).prev(".userlist").addClass("usershow");var a=Math.floor($(this).prev(".userlist").width()/($(this).prev(".userlist").find("li").width()+20)),b=Math.ceil($(this).prev(".userlist").find("li").size()/a),c=$(this);switch(b){case 0:case 1:break;case 2:f(c,b);break;default:f(c,3)}}),$(".showless").click(function(){$(this).parent().find(".userlist").removeClass("usershow"),$(this).parent().find(".userlist").animate({height:"100px"},500),$(this).parent().find(".showmore").show(),$(this).parent().find(".showless").css("margin-top","70px").hide()}),$(".minilistsbtn").click(function(){switch($(".minilistsbtn").stop(!0,!0).toggleClass("minilistsbtndown"),$(".minilistsbtn").text()){case"展开":$(".minilistsbtn span").text("收起"),$(".minilistsline").fadeIn();break;case"收起":$(".minilistsbtn span").text("展开"),$(".minilistsline").fadeOut()}});var g=$(".minilistsline .minifloor").length;0==g?($(".minilistsline").hide(),$(".minilistsbtn").hide()):g>0&&g<7?$(".minilistsline").css("height",40+70*(g-1)+"px"):$(".minilistsline").css("height","390px"),$(".minifloortitle").hover(function(){$(".minilistsline").css({"z-index":"1000",width:"190px"}),$(this).parent().hasClass("active")||$(this).addClass("hover"),$(this).next(".minifloorcontent").stop(!0,!0).fadeIn()},function(){$(".minilistsline").css({"z-index":"1",width:"50px"}),$(this).removeClass("hover"),$(this).next(".minifloorcontent").stop(!0,!0).fadeOut()}),$(".minifloortitle").click(function(){$(this).closest(".minifloor").addClass("active").siblings().removeClass("active")});var h=$(".minilistsline").height(),i=$(".minilistsline").find(".cnt").height();if(i<=h)$(".bar").hide(),$(".cnt").css("width",$(".cnt").width()+10+"px");else{var j=h*h/i>20?h*h/i:20;$(".bar").css("height",j+"px")}$(".bar").mousedown(function(a){var b=$(this),c=a.clientY,d=b.position().top,e=b.data("mark")||"true",f=$(".minilistsline").height()-$(".bar").height(),g=$(".minilistsline").find(".cnt").height()-$(".minilistsline").height();k(),$(document).mousemove(function(a){if("true"==e){var h=a.clientY,i=h-c+d;i<=0&&(i=0),i>=f&&(i=f);var j=i/f;b.css({top:i}),b.parents(".minilistsline").find(".cnt").css("top",g*j*-1)}}).mouseup(function(){e="false",b.data("mark","true"),l()})}),$(".cbar").mousedown(function(a){var b=$(this),c=a.clientY-b.parents(".minilistsline").offset().top+$(window).scrollTop(),d=$(".bar").position().top,e=$(".bar").height(),f=$(".minilistsline").height()-$(".bar").height(),g=$(".minilistsline").find(".cnt").height()-$(".minilistsline").height();c<d?(b.next().animate({top:c},500),b.parents(".minilistsline").find(".cnt").animate({top:g*(c/f)*-1},500)):c>d+e&&(b.next().animate({top:c-e},500),b.parents(".minilistsline").find(".cnt").animate({top:g*((c-e)/f)*-1},500)),l()});var k=function(){$(document).bind("selectstart",function(){return!1}),document.onselectstart=new Function("event.returnValue=false;"),$("*").css({"-moz-user-select":"none"})},l=function(){$(document).bind("selectstart",function(){return!0}),document.onselectstart=new Function("event.returnValue=true;"),$("*").css({"-moz-user-select":""})};$(".pagemain").click(function(){var a=parseInt($(this).attr("data-cur")),b=(parseInt($(this).attr("data-count")),$(this).attr("data-parms")),c=decodeURIComponent(window.location.href),d=tool.getParams.obj(c.split("?")[1]).tid;console.log(c.split("?")[0]+"?tid="+d+"&"+b+"&curpage="+a)});var m=null;$("body").on("click",".arrow",function(){$(this).next(".houselist").stop(!0,!0).slideToggle()}),$(".private-msg").click(function(){m=$(this).parents(".postcontent").attr("authorid"),checkLoginFun(function(){var a="";a+='<div class="pirvatemsg-tcc"><div class="private-head"><i class="ar ar-envelope" ></i>',a+="发送私信",a+='<i class="ar ar-cancel-circle cancle" title="取消"></i></div>',a+='<div class="private-content "><textarea name=""></textarea></div>',a+='<div class="private-tips">当前已输入',a+='<span class="words-num">0</span>个字符,',a+='<span class="words-restrict">您还可以输入</span>',a+='<span class="rest-wordnum">300</span>个字符',a+='</div><a class="btn-send">发送</a></div>',$("body").append(a)})});var n={oldval:"",checkLength:function(a,b){var b=b,c=$.trim(a.val()).length,d=b-c;d>=0?($(".words-num").text(c),$(".rest-wordnum").text(d),$(".private-tips").removeClass("over-alert2"),$(".private-content textarea").removeClass("over-alert"),$(".words-restrict").text("您还可以输入")):($(".words-num").text(c),$(".rest-wordnum").text(-d),$(".private-tips").addClass("over-alert2"),$(".private-content textarea").addClass("over-alert"),$(".words-restrict").text("您已超出"));var e=$(".common-form .tip");e.text(e.text().replace(/(\+|\-)?\d+/,Math.ceil(d))),n.oldval=a.val()}};$("body").on("keyup",".private-content textarea",function(){var a=$(this);n.checkLength(a,300)}),$("body").on("click",".private-head .cancle",function(){$(".pirvatemsg-tcc").remove()}),$("body").on("click",".pirvatemsg-tcc .btn-send",function(){var a=$.trim($(".private-content textarea").val()).length;if(a>300)return void tool.showMsg("error","私信长度不能超过300字");if(a<=0)return void tool.showMsg("error","私信内容不能为空");var b=$(this),c=b.html(),d={fid:m,userid:$(".repostauthorid").val(),method:"ucaction.user.send.personal.letters",content:b.siblings(".private-content").find("textarea").val()};$.ajax({type:"POST",data:d,url:snsurl_uc_url+"/router/rest",async:!1,beforeSend:function(){b.html("发送中..."),b.attr("disabled","disabled")},complete:function(){b.html(c),b.removeAttr("disabled")},success:function(){tool.showMsg("success","发送成功")},error:function(){tool.showMsg("error","发送失败"),b.removeAttr("disabled")}}),$(".pirvatemsg-tcc").remove()});var o=!0;$(".share-btn a").click(function(){if(o){var a={userid:$("#currentLoginUserId").val(),userName:$("#currentLoginUserNickName").val(),eid:"577626d888b958411ce93002",method:"ucaction.userwealth.calculatewealth"};null!=$("#currentLoginUserNickName").val()&&""!=$("#currentLoginUserNickName").val()&&(o=!1,$.ajax({type:"POST",data:a,url:snsurl_uc_url+"/router/rest",async:!1,success:function(){setTimeout(function(){o=!0,console.log(o)},2e3)}}))}})},showuserlist:function(a){var b=Math.floor(a.width()/(a.find("li").width()+20)),c=a.find("li").size();c>0&&(a.closest(".awarddetail").show(),c<=b&&a.next(".showmore").hide())}},imgAndText:function(){forumpost.common.autoaction(),forumpost.common.showuserlist($(".userlist"))},diarypost:function(){forumpost.common.autoaction(),forumpost.common.showuserlist($(".userlist"))},qapost:function(){forumpost.common.autoaction(),$(".userlist").each(function(a,b){forumpost.common.showuserlist($(this))})},votepost:function(){forumpost.common.autoaction(),forumpost.common.showuserlist($(".userlist"));var a=["#99CBEE","#99EFCF","#97F2FF","#CCF380","#D09DFF","#FB8A9C","#FFAEDA","#FDA88E","#C780B7","#3CCFBB","#C5D652","#FEF96D","#C49B83","#E9B88B","#FFC851","#F26B5D"],b=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P"];$("li",".votepostbox").on("click",function(){if($(this).closest("ul").hasClass("radio"))$("li",".votepostbox").removeClass("active"),$(this).addClass("active");else{var a=parseInt($(".votenum",".votepostbox").text());$(this).find("span.index").css("background-color");$(this).hasClass("active")?$(this).removeClass("active"):$(".active",".votelistbox").length===a?tool.showMsg("info","最多可选"+a+"项！"):$(this).addClass("active")}}),$(".votelistbox,.voteresultlist").each(function(){$(this).find("li").each(function(c,d){$(d).find(".index").text(b[c]).css("background-color",a[c]),$(d).find(".rate").css("background-color",a[c])})}),$(".voteresultlist .rate").each(function(){$(this).width(606*$(this).attr("count")+"px")})},activepost:function(){forumpost.common.autoaction(),$(".userlist").each(function(a,b){var c=Math.floor($(this).width()/($(this).find("li").width()+20)),d=$(this).find("li").size();d>0?($(this).closest(".awarddetail").show(),d<=c&&$(this).next(".showmore").hide()):($(this).parent().hide(),$(this).parent().prev(".seeunallow").hide())}),$(".seeunallow").click(function(){$(".unallowjoin").stop(!0,!0).slideToggle()}),$("body").on("focus",".inputitems input",function(){$(this).addClass("outlinered")}),$("body").on("blur",".inputitems input",function(){$(this).removeClass("outlinered")});var a=$("#activedialog").height();$("#activedialog").css("margin-top",-a/2+"px");var b=$(".dialogerror"),c=function(){b.text("").prev().hide()},d=function(a){b.text(a).prev().show()},e=function(a){var b=/^1[3|4|5|7|8][0-9]{8}\d+$/,a=a.replace(/\s+/g,"");return b.test(a)?(c(),!0):(d(0==a.length?"手机号不能为空":"请输入11位有效手机号码"),!1)},f=function(){var a=!0;return $(".notnull").parent().next().each(function(b,e){if(0==$(this).val().length)return d($(this).prev().find("span").eq(0).text()+"不能为空"),a=!1,!1;c()}),a};$(".notnull").parent().next().blur(function(){0==$(this).val().replace(/\s+/g,"").length?d($(this).prev().find("span").eq(0).text()+"不能为空"):c()});var g=function(){var a=$("input[name = '姓名']").val(),b=a.replace(/^\s*(\S+)\s*$/g,"$1");return!(!b.match(/^([\u4e00-\u9fa5a-zA-Z]+)$/)||0==b.length)||(d("只可输入10字符中文，英文"),!1)};$("input[name = '姓名']").blur(g);var h=function(){var a=$("input[name = '电话']").val(),b=($("input[name = '电话']"),$("#Regist_tid").val()),f=!1;return e(a)?$.ajax({url:baseUrl+"/sns/CheckPhoneNum",type:"POST",async:!1,data:{phonenum:a,tid:b},success:function(a){0==a.status?(d($(this).prev().find("span").eq(0).text()+"此号码已经提交过申请"),f=!1):1==a.status&&(c(),f=!0)}}):f=!0,f};$("input[name = '电话']").blur(h),$("#activedialog .joinin").click(function(){for(var a=($(".enterActForm"),$("#inputcode").val(),$("#SecCode").val(),$("input[name='姓名']").val()),b=$("input[name='电话']").val(),c=$("#Regist_tid").val(),d=$("#Regist_fid").val(),i=$("#Regist_cid").val(),j=document.getElementsByName("itemInfo"),k="",l=$(".dialogerror").text(),m=0;m<j.length;m++)k+=j[m].id+":"+j[m].value+",";if(f()&&g()&&e(b)&&h()&&!l){var n={tid:c,fid:d,cid:i,realname:a,phonenum:b,rule:k};$.ajax({type:"post",url:baseUrl+"/sns/enterAct",dataType:"json",data:n,success:function(a){0==a.status?tool.showMsg("success",a.msg):tool.showMsg("info",a.msg),$(".register").addClass("btn-disabled  registered").removeClass("btn btn-default register").text("已报名").css({"font-size":"14px","font-weight":"bold"}),$(".btn-disabled.registered").unbind("click"),$("#activedialog").stop(!0,!0).fadeOut()}})}}),$(".activeinfo .register").click(function(){checkLoginFun(function(){$("#activedialog").stop(!0,!0).fadeIn()})}),$("#activedialog .close").click(function(){$("#activedialog").stop(!0,!0).fadeOut()})}};