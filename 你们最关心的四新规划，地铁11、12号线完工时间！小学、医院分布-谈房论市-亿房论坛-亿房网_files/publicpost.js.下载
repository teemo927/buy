"use strict";var builddata=[],appendbuild,insertHouseToHtml,ue=getSimpleEditor("container"),lanmu='<li class="firstlevel"><span>栏目1</span></li><li class="firstlevel"><span>栏目2</span></li><li class="firstlevel"><span>栏目3</span></li>',ajax2=function(a,b,c,d){c=$.extend(c,{method:a,timestamp:tool.getFullDate((new Date).getTime())}),c.v=c.v||1e3;var e=tool.getSuccessMethod(a);if(c.requrl){var f=c.requrl;delete c.requrl}$.ajax({async:!1,type:b||"Get",url:f||snsurl_uc_url+"/router/rest",data:c,dataType:"json",success:function(a){d&&d(a,e)},error:function(a){tool.confirm(a.responseText)}})};$(".pagemain").click(function(){var a=parseInt($(this).attr("data-cur")),b=(parseInt($(this).attr("data-count")),$(this).attr("data-parms"),decodeURIComponent(window.location.href));b.indexOf("#")>-1&&(b=b.substr(0,b.indexOf("#")));for(var c=b.split("-"),d=0;d<c.length;d++)if(2==d)if(c[d].indexOf(".html")>-1){var e=c[d];c[d]=a+"."+e.split(".")[1]}else c[d]=a;b=c.join("-"),window.location.href=b});var gotoFloor=function(){var a=$(".gotofloor .floornum").val();if(!/^[1-9]+[0-9]*$/.test(a))return void tool.showMsg("error","请输入合法数字！");var b=$(".postcounts").val();if(parseInt(a)>parseInt(b))return void tool.showMsg("error","楼层不存在！");var c=0;c=a%10==0?Math.floor(a/10):Math.floor(a/10+1);var d=a-10*(c-1),e=$("span.goto.floor").attr("data-parms");e=e.replace(/dateline/,"floor"),e=e.replace(/highscore/,"floor");for(var f=decodeURIComponent(window.location.href),g=f.split("-"),h=0;h<g.length;h++){if(2==h)if(g[h].indexOf(".html")>-1){var i=g[h];g[h]=c+"."+i.split(".")[1]}else g[h]=c;5==h&&(g[h]="0.html")}f=g.join("-"),f.indexOf("#")>-1&&(f=f.substring(0,f.indexOf("#"))),window.location.href=f+"#postcontent"+d};$("span.goto.floor").click(function(){gotoFloor()}),$(".gotofloor input").keyup(function(a){13==a.keyCode&&gotoFloor()});var gotoPage=function(){var a=$(".gotopage .pagenum").val();if(!/^[1-9]+[0-9]*$/.test(a))return void tool.showMsg("error","请输入合法数字！");var b=$(".pagemain");b.attr("data-parms");if(a>parseInt(b.attr("data-count")))return void tool.showMsg("error","您输入的数字大于最大页数！");for(var c=decodeURIComponent(window.location.href),d=c.split("-"),e=0;e<d.length;e++)if(2==e)if(d[e].indexOf(".html")>-1){var f=d[e];d[e]=a+"."+f.split(".")[1]}else d[e]=a;var g=d.join("-");window.location.href=g};$("span.goto.page").click(function(){gotoPage()}),$(".gotopage input").keyup(function(a){13==a.keyCode&&gotoPage()});var dialogbtn={deletepost:function(a,b,c){var d=0;"postcontent0"==c&&(d=1);var e=dialog({width:370,height:82,id:"delete",skin:"delete",title:"删除",content:'<textarea placeholder="理由。。。" class="inputreason" style="width:340px;height:60px;margin:0 auto;resize:none;overflow:auto"></textarea>',lock:!0,fixed:!0,statusbar:'<span class="commonreason">常用理由</span>',cancel:function(){e.close().remove()},ok:function(){var f=$(".inputreason").val(),g=$(".repostauthorid").val(),h=$(".reposttid").val(),i=$(".repostfid").val(),j=$(".repostauthorid").val(),k=a,l=null,m={};return m.authorid=g,m.fid=i,m.uid=j,m.pid=k,m.tid=h,m.isdelete=1,m.targetType=1,1==c&&(m.first=1),0!=b&&(l=b,m.targetType=2,m.cid=l),m.actionType=3,m.reason=f,m.async=!1,f?tool.ajax(BASE_URL+"/post/passpost","get",m,function(){tool.showMsg("success","删除成功！",function(){var a=BASE_URL+"/forum-"+i+"-1.html";1==d?window.location.href=a:window.location.reload()})}):tool.showMsg("error","删除理由不能为空!"),e.close().remove(),!1},cancelValue:"取消",okValue:"确定"});e.show()},reason:function(a){dialog({width:370,id:"reason",skin:"reason",title:"常用理由",content:a,lock:!0,fixed:!0,ok:function(){var a=$(".reasonlist").find(".checked").next().text();$(".inputreason").val(a)},okValue:"提交"}).show()},push:function(a){var b="全部频道";""!=a.fid&&null!=a.fid&&(b=a.fid);var c="请选择";if(""!=a.bid&&null!=a.bid&&(c=a.bid),"全部频道"!=b){var d="",e=encodeURI(b),f=BASE_URL+"/post/getbannerlist?selecttext="+e;$.get(f).success(function(a){for(var b in a)for(var c=0;c<a[b].length;c++)d+='<li class="firstlevel">  <span>'+a[b][c].title+"</span></li>";$("#selectlist2").empty(),$("#selectlist2").append(d)})}var g=dialog({width:370,id:"push",skin:"push",title:"推送贴子",content:'<div class="choosebox choosespace">  <span class="choosetitle space">选择板块</span>  <span>:</span>  <div class="selectbox">    <span class="select section">      <span class="selecttext sectionname">'+b+'</span>      <i></i>    </span>    <ul class="selectlist" id="selectlist1">    </ul>  </div></div><div class="choosebox choosead">  <span class="choosetitle">选择广告位</span>  <span>:</span>  <div class="selectbox">    <span class="select section">      <span class="selecttext adname">'+c+'</span>      <i></i>    </span>    <ul class="selectlist" id="selectlist2">'+lanmu+"</ul>  </div></div>",lock:!0,fixed:!0,cancel:function(){g.close().remove()},ok:function(){var a=$(".sectionname").text(),b=$(".adname").text(),c=$(".reposttid").val(),d={};"全部频道"!=a&&"请选择"!=b?(d.sectionname=escape(a),d.adname=escape(b),d.position="今日热贴"==b?2:"互动专区"==b?3:1,d.tid=c,d.authorid=$(".repostauthorid").val(),d.author=$(".repostauthor").val(),d.targetType=0,d.actionType=9,$.ajax({url:BASE_URL+"/post/pushpost",type:"GET",async:!1,data:d,success:function(a){"ok"==a?tool.showMsg("success","该贴已推送！"):tool.showMsg("error","推送失败："+a)}})):tool.showMsg("info","请选择版块和广告位！")},cancelValue:"取消",okValue:"确定"});g.show();var h="";for(var i in a.forumlist){h+='<li class="firstlevel">  <span>'+i+'</span>  <ul class="secondlevel">';for(var j=0;j<a.forumlist[i].length;j++)h+="<li>"+a.forumlist[i][j].name+"</li>";h+="  </ul></li>"}$("#selectlist1").append(h),$(".choosespace .secondlevel").each(function(a,b){0==$(this).find("li").length&&$(this).remove()})},informant:function(a,b){dialog({width:350,skin:"informant",id:"informant",title:"举报",content:'<div class="contitle">请点击举报理由</div><ul class="informantlist">  <li>    <i class="checkicon"></i>    <span class="checktext">广告垃圾</span>  </li>  <li>    <i class="checkicon"></i>    <span class="checktext">违规内容</span>  </li>  <li>    <i class="checkicon"></i>    <span class="checktext">恶意灌水</span>  </li>  <li>    <i class="checkicon"></i>    <span class="checktext">重复发贴</span>  </li>  <li>    <i class="checkicon"></i>    <span class="checktext other">其它</span>    <input type="text" class="informanttext" disabled="disabled">  </li></ul>',lock:!0,fixed:!0,ok:function(){var c=$(".informantlist").find(".checked").next(),d=c.text(),e=$(".repostfid").val(),f=$(".reposttid").val(),g=a,h=b,i={};if("其它"==d){d=c.next().val();var j=$.trim(d).length;if(j>30)return void tool.showMsg("error","理由不能超过30字");if(j<=0)return void tool.showMsg("error","举报理由不能为空")}if(i.fid=e,i.tid=f,i.pid=g,i.cid=h,i.reason=d,!d)return tool.showMsg("error","举报理由不能为空！"),!1;tool.ajax(BASE_URL+"/post/report","post",i,function(){tool.showMsg("success","举报成功！")})},okValue:"提交"}).show()},reward:function(a){var b=$("#rewardpower").val(),c="\t<ul>";if(-1!=b.indexOf("alloweditpoll_1")||-1!=b.indexOf("alloweditpoll_2")||-1!=b.indexOf("alloweditpoll_3"))if(1==a.snsTheme.stick?c+='    <li class="selectlistbox">      <span class="settitle f-l">置顶：</span>      <div class="f-l">        <span class="select">          <span  class="content settop">全局置顶</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>':2==a.snsTheme.stick?c+='    <li class="selectlistbox">      <span class="settitle f-l">置顶：</span>      <div class="f-l">        <span class="select">          <span  class="content settop">分类置顶</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>':3==a.snsTheme.stick?c+='    <li class="selectlistbox">      <span class="settitle f-l">置顶：</span>      <div class="f-l">        <span class="select">          <span  class="content settop">本版置顶</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>':c+='    <li class="selectlistbox">      <span class="settitle f-l">置顶：</span>      <div class="f-l">        <span class="select">          <span  class="content settop">请选择</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>',-1!=b.indexOf("alloweditpoll_1")&&(c+='<li  class="setcontent">全局置顶</li>'),-1!=b.indexOf("alloweditpoll_2")&&(c+='<li  class="setcontent">分类置顶</li>'),-1!=b.indexOf("alloweditpoll_3")&&(c+='<li  class="setcontent">本版置顶</li>'),null!=a.deadlinezd){var d=new Date(a.deadlinezd).format("yyyy-MM-dd");c+='</ul></div> <input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+d+'" /></li>'}else c+='</ul></div> <input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" /></li>';if(-1!=b.indexOf("allowdigestthread_1")||-1!=b.indexOf("allowdigestthread_2")||-1!=b.indexOf("allowdigestthread_3"))if(1==a.snsTheme.digest?c+='    <li class="selectlistbox">      <span class="settitle f-l">精华：</span>      <div class="f-l">        <span class="select">          <span  class="content elite">精华1</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>':2==a.snsTheme.digest?c+='    <li class="selectlistbox">      <span class="settitle f-l">精华：</span>      <div class="f-l">        <span class="select">          <span  class="content elite">精华2</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>':3==a.snsTheme.digest?c+='    <li class="selectlistbox">      <span class="settitle f-l">精华：</span>      <div class="f-l">        <span class="select">          <span  class="content elite">精华3</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>':c+='    <li class="selectlistbox">      <span class="settitle f-l">精华：</span>      <div class="f-l">        <span class="select">          <span  class="content elite">请选择</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>',-1!=b.indexOf("allowdigestthread_1")&&(c+='<li  class="setcontent">精华1</li>'),-1!=b.indexOf("allowdigestthread_2")&&(c+='<li  class="setcontent">精华2</li>'),-1!=b.indexOf("allowdigestthread_3")&&(c+='<li  class="setcontent">精华3</li>'),null!=a.deadlinejh){var e=new Date(a.deadlinejh).format("yyyy-MM-dd");c+='</ul></div> <input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+e+'" /></li>'}else c+='</ul></div> <input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" /></li>';if(-1!=b.indexOf("allowhighlightthread"))if(1==a.snsTheme.highlight)if(null!=a.deadlinezs){var f=new Date(a.deadlinezs).format("yyyy-MM-dd");c+='<li class="selectlistbox">      <span class="settitle f-l">装饰：</span>      <div class="f-l">        <span class="select">          <span class="content adorn">装饰</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>          <li class="setcontent">装饰</li>        </ul>      </div>      <input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+f+'" />    </li>  </ul>'}else c+='<li class="selectlistbox">      <span class="settitle f-l">装饰：</span>      <div class="f-l">        <span class="select">          <span class="content adorn">装饰</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>          <li class="setcontent">装饰</li>        </ul>      </div>      <input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" />    </li>  </ul>';else c+='<li class="selectlistbox">      <span class="settitle f-l">装饰：</span>      <div class="f-l">        <span class="select">          <span class="content adorn">请选择</span>          <i></i>        </span>        <ul class="selectlist">          <li class="reset">解除</li>          <li class="setcontent">装饰</li>        </ul>      </div>      <input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" />    </li>  </ul>';dialog({width:350,skin:"reward",id:"rewar",title:"奖励",content:c,lock:!0,fixed:!0,ok:function(){var a=function(a,b,c){var a={};return a.value1=b,a.value2=c,a},b=function(){var b={};return b.authorid=$(".repostauthorid").val(),b.posttid=$(".reposttid").val(),b.fid=$(".repostfid").val(),b.pid=$(".repostpid").val(),$(".selectlistbox").each(function(c,d){if("请选择"!=$(this).find(".content").text()){var e=$(this).find(".content").text(),f=$(this).find(".selectdate").val();if($(this).find(".content").hasClass("settop")){var g=a(g,e,f);b.settop=g}if($(this).find(".content").hasClass("elite")){var h=a(h,e,f);b.elite=h}if($(this).find(".content").hasClass("adorn")){var i=a(i,e,f);b.adorn=i}}}),b};jQuery.isEmptyObject(b())||tool.ajax(BASE_URL+"/post/rewardpost","get",b(),function(){tool.showMsg("success","该贴已奖励！")})},okValue:"提交"}).show()},updown:function(a){var b="";null!=a.deadline&&(b=new Date(a.deadline).format("yyyy-MM-dd"));var c='<div class="f-l uptheme">  <i class="checkicon"></i>  <span class="checktext">提升主题</span></div><input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限"  value="'+b+'" /><div class="f-r downtheme">  <i class="checkicon"></i>  <span class="checktext">下沉主题</span></div><input type="hidden" class="inputreason" />';1==a.snsTheme.upordown?c='<div class="f-l uptheme">  <i class="checkicon checked"></i>  <span class="checktext">提升主题</span></div><input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+b+'" /><div class="f-r downtheme">  <i class="checkicon"></i>  <span class="checktext">下沉主题</span></div><input type="hidden" class="inputreason" />':-1==a.snsTheme.upordown&&(c='<div class="f-l uptheme">  <i class="checkicon"></i>  <span class="checktext">提升主题</span></div><input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+b+'"/><div class="f-r downtheme">  <i class="checkicon checked"></i>  <span class="checktext">下沉主题</span></div><input type="hidden" class="inputreason" />');var d=dialog({width:370,height:50,id:"updown",skin:"updown",title:"升降",content:c,lock:!0,fixed:!0,statusbar:'<span class="commonreason">常用理由</span>',cancel:function(){d.close().remove()},ok:function(){var a=$(".checkicon.checked").next(),b=a.text(),c=$(".selectdate").val(),d=$(".inputreason").val(),e=$(".repostauthorid").val(),f=$(".reposttid").val(),g=$(".repostfid").val(),h=$(".repostpid").val(),i={};if(!b)return tool.showMsg("info","至少选择一项进行操作！"),!1;i.authorid=e,i.fid=g,i.pid=h,i.tid=f,i.targetType=0,i.actionType=1,d&&(i.reason=d),"提升主题"==b?(i.upordown=1,null!=c&&""!=c&&(i.deadline=new Date(c))):"下沉主题"==b&&(i.upordown=-1,d&&(i.reason=d)),tool.ajax(BASE_URL+"/post/passpost","get",i,function(){1==i.upordown?tool.showMsg("success","该贴已上升！"):-1==i.upordown&&tool.showMsg("success","该贴已下沉！")})},cancelValue:"取消",okValue:"确定"});d.show()},transfer:function(a){var b="全部频道";""!=a.fname&&null!=a.fname&&(b=a.fname);var c="请选择";if(""!=a.cname&&null!=a.cname&&(c=a.cname),"全部频道"!=b){var d=encodeURI(b),e=BASE_URL+"/post/getlaberlist?selecttext="+d;$.get(e).success(function(a){var b="";for(var c in a)for(var d=0;d<a[c].length;d++)b+='<li class="firstlevel">  <span>'+a[c][d].name+"</span></li>";$("#selectlist4").empty(),$("#selectlist4").append(b)})}var f=dialog({width:370,id:"transfer",skin:"transfer",title:"转移贴子",content:'<div class="choosebox chooseplate f-l">  <span class="choosetitle plate">选择板块</span>  <span>:</span>  <div class="selectbox">    <span class="select section">      <span class="selecttext sectionname">'+b+'</span>      <i></i>    </span>    <ul class="selectlist" id="selectlist3">    </ul>  </div></div><div class="choosebox choosetips f-r">  <span class="choosetitle tips">选择标签</span>  <span>:</span>  <div class="selectbox">    <span class="select section">      <span class="selecttext tipsname">'+c+'</span>      <i></i>    </span>    <ul class="selectlist" id="selectlist4">    </ul>  </div></div>',lock:!0,fixed:!0,cancel:function(){f.close().remove()},ok:function(){var a=$(".sectionname").text(),b=$(".tipsname").text(),c=$(".reposttid").val(),d={};"全部频道"!=a&&"请选择"!=b?(d.sectionname=a,d.tipsname=b,d.tid=c,d.authorid=$(".repostauthorid").val(),d.pid=$(".repostpid").val(),d.targetType=0,d.actionType=10,tool.ajax(BASE_URL+"/post/removepost","get",d,function(){tool.showMsg("success","该贴已转移！"),window.location.reload()})):tool.showMsg("info","请选择板块和标签！")},cancelValue:"取消",okValue:"确定"});f.show();var g="";for(var h in a.forumlist){g+='<li class="firstlevel">  <span>'+h+'</span>  <ul class="secondlevel">';for(var i=0;i<a.forumlist[h].length;i++)g+="<li>"+a.forumlist[h][i].name+"</li>";g+="  </ul></li>"}$("#selectlist3").append(g)},shutup:function(a,b,c){var d="";null!=c.deadline&&(d=new Date(c.deadline).format("yyyy-MM-dd"));var e='<div class="f-l shutuped">  <i class="checkicon"></i>  <span class="checktext">禁言</span></div><input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+d+'"  /><div class="f-r unshutuped">  <i class="checkicon"></i>  <span class="checktext">解除</span></div><input type="hidden" class="inputreason" />';null!=c.snsTheme&&1==c.snsTheme.forbidpost&&(e='<div class="f-l shutuped">  <i class="checkicon checked"></i>  <span class="checktext">禁言</span></div><input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+d+'"  /><div class="f-r unshutuped">  <i class="checkicon"></i>  <span class="checktext">解除</span></div><input type="hidden" class="inputreason" />');var f=dialog({width:370,height:50,id:"shutup",skin:"shutup",title:"禁言",content:e,lock:!0,fixed:!0,statusbar:'<span class="commonreason">常用理由</span>',cancel:function(){f.close().remove()},ok:function(){var c=$(".checkicon.checked").next(),d=c.text(),e=$(".selectdate").val(),f=$(".inputreason").val(),g=$(".repostauthorid").val(),h=$(".reposttid").val(),i=$(".repostfid").val(),j=a,k=null,l={};if(!d)return tool.showMsg("info","至少选择一项进行操作！"),!1;l.authorid=g,l.fid=i,l.pid=j,l.tid=h,l.actionType=11,l.targetType=1,0!=b&&(k=b,l.targetType=2,l.cid=k),f&&(l.reason=f),"禁言"==d?(l.forbidpost=1,null!=e&&""!=e&&(l.deadline=new Date(e))):"解除"==d&&(l.forbidpost=0,f&&(l.reason=f)),tool.ajax(BASE_URL+"/post/passpost","get",l,function(){1==l.forbidpost?tool.showMsg("success","该用户已禁言！"):tool.showMsg("success","禁言已解除！")})},cancelValue:"取消",okValue:"确定"});f.show()},forbidden:function(a){var b="";null!=a.deadline&&(b=new Date(a.deadline).format("yyyy-MM-dd"));var c='<div class="f-l forbiddened">  <i class="checkicon" ></i>  <span  class="checktext">禁评</span></div><input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+b+'" /><div class="f-r unforbiddened">  <i class="checkicon"></i>  <span  class="checktext">解除</span></div><input type="hidden" class="inputreason" />';1==a.snsTheme.closed&&(c='<div class="f-l forbiddened">  <i class="checkicon checked"></i>  <span  class="checktext">禁评</span></div><input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+b+'" /><div class="f-r unforbiddened">  <i class="checkicon"></i>  <span  class="checktext">解除</span></div><input type="hidden" class="inputreason" />');var d=dialog({width:370,height:50,id:"forbidden",skin:"forbidden",title:"禁评",content:c,lock:!0,fixed:!0,statusbar:'<span class="commonreason">常用理由</span>',cancel:function(){d.close().remove()},ok:function(){var a=$(".checkicon.checked").next(),b=a.text(),c=$(".selectdate").val(),d=$(".inputreason").val(),e=$(".repostauthorid").val(),f=$(".reposttid").val(),g=$(".repostfid").val(),h=$(".repostpid").val(),i={};if(!b)return tool.showMsg("info","至少选择一项进行操作！"),!1;i.authorid=e,i.fid=g,i.pid=h,i.tid=f,i.targetType=0,i.actionType=0,d&&(i.reason=d),"禁评"==b?(i.closed=1,null!=c&&""!=c&&(i.deadline=new Date(c))):"解除"==b&&(i.closed=0,d&&(i.reason=d)),tool.ajax(BASE_URL+"/post/passpost","get",i,function(){1==i.closed?tool.showMsg("success","该贴已禁评！"):tool.showMsg("success","禁评已解除！")})},cancelValue:"取消",okValue:"确定"});d.show()},shield:function(a,b,c){var d="";null!=c.deadline&&(d=new Date(c.deadline).format("yyyy-MM-dd"));var e='<div class="f-l shielded">  <i class="checkicon"></i>  <span class="checktext">屏蔽</span></div><input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+d+'" /><div class="f-r unshielded">  <i class="checkicon"></i>  <span class="checktext">解除</span></div><input type="hidden" class="inputreason" />';null!=c.snsTheme&&1==c.snsTheme.shield&&(e='<div class="f-l shielded">  <i class="checkicon checked"></i>  <span class="checktext">屏蔽</span></div><input type="text" class="selectdate f-l" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择期限" value="'+d+'" /><div class="f-r unshielded">  <i class="checkicon"></i>  <span class="checktext">解除</span></div><input type="hidden" class="inputreason" />');var f=dialog({width:370,height:50,id:"shield",skin:"shield",title:"屏蔽",content:e,lock:!0,fixed:!0,statusbar:'<span class="commonreason">常用理由</span>',cancel:function(){f.close().remove()},ok:function(){var c=$(".checkicon.checked").next(),d=c.text(),e=$(".selectdate").val(),f=$(".inputreason").val(),g=$(".repostauthorid").val(),h=$(".reposttid").val(),i=$(".repostfid").val(),j=a,k=null,l={};if(!d)return tool.showMsg("info","至少选择一项进行操作！"),!1;l.authorid=g,l.fid=i,l.pid=j,l.targetType=1,0!=b&&(k=b,l.cid=k,l.targetType=2),l.tid=h,l.actionType=2,f&&(l.reason=f),"屏蔽"==d?(l.shield=1,null!=e&&""!=e&&(l.deadline=new Date(e))):"解除"==d&&(l.shield=0,f&&(l.reason=f)),tool.ajax(BASE_URL+"/post/passpost","get",l,function(){1==l.shield?tool.showMsg("success","该贴已屏蔽！",function(){window.location.reload()}):tool.showMsg("success","屏蔽已解除！",function(){window.location.reload()})})},cancelValue:"取消",okValue:"确定"});f.show()},insert:function(){dialog({width:370,id:"insert",skin:"insert",title:"插入楼盘和楼盘信息",content:'<ul class="houselistbox"></ul><input type="text" class="inputhouse" placeholder="输入楼盘名">',lock:!0,fixed:!0,ok:function(){if(0==$(".houselistitem").size())return tool.showMsg("error","请至少插入一个楼盘！",function(){$(".inputhouse").val(""),$(".inputhouse").focus()},1e3),!1;if(0==$(".checkallicon.checked").size())return tool.showMsg("error","请至少勾选一项！"),!1;$(".houselistitem").each(function(a,b){if($(this).find(".checked").length>0){var c={buildid:"",buildname:"",view:"",album:"",unit:"",bibi:"",map:"",house_name:""},d="",e=$(this).find(".buildnick").val(),f=$(this).find(".housetitle .checktext").text(),g=$(this).find(".citydomainCls").val();c.house_name=f,c.buildid=$(this).find(".buildid").val(),c.citydomain=g,c.nickname=e,d+='<li class="buildinfo">  <div class="estatedetailinfo">    <span class="estatetital">'+f+'</span>  </div>  <ul class="buildbtnbox">',$(this).find(".housetitle .checkallicon").hasClass("checked")&&(c.buildname=f,d+='<li class="buildbtnlist buildname">  <span title='+f+">"+f+'</span>  <i class="deleteicon"></i></li>');var h=e+"."+g+"."+$("#newhouse_afterdomain").val();$(this).find(".houseinfoitems").each(function(){if($(this).find(".checked").length>0)switch($(this).index()){case 0:c.view="http://"+h+"/detail.html",d+='<li class="buildbtnlist view">  <span>详情</span>  <i class="deleteicon"></i></li>';break;case 1:c.album="http://"+h+"/album",d+='<li class="buildbtnlist album">  <span>相册</span>  <i class="deleteicon"></i></li>';break;case 2:c.unit="http://"+h+"/housetype",d+='<li class="buildbtnlist unit">  <span>户型</span>  <i class="deleteicon"></i></li>';break;case 3:c.bibi="http://"+h+"/news",d+='<li class="buildbtnlist bibi">  <span>资讯</span>  <i class="deleteicon"></i></li>';break;case 4:c.map="http://"+h+"/#nearMap",d+='<li class="buildbtnlist map">  <span>周边地图</span>  <i class="deleteicon"></i></li>'}}),d+="</ul></li>",builddata.push(c),$(".buildinsertbox").append(d)}});JSON.stringify(builddata);console.log(builddata)},okValue:"插入"}).show();var a=function(a){var c=$("#homeOldApiRouterRest").val(),d={requrl:c,from:99,name:a,sharding_id:"wh"};tool.ajaxJsonp("homeoldapi.restful.inter.keyword.getResidential","get",d,function(a,c){if(a[c]){var d=a[c].data;d&&$("input.inputhouse").autoComplete({displayMember:"residentialName",valueMember:"id",paramMember:"pinyin",paramMember2:"districtId",minWidth:156,maxDataLength:10,getSourceCallback:function(a,b){b.source(d)},reInvokeFun:function(){var a={};a.buildname=$(".inputhouse").val(),a.buildnickname=$(".inputhouse").attr("param-key");var c=$("#newhouse_citydomain").val(),d=$.parseJSON(c.replace(/\'/g,'"')),e=$(".inputhouse").attr("param-key2");if(e&&""!=e){var f=e.substring(0,5);a.citydomain=d[f]}a.buildid=$(".inputhouse").attr("data-key"),b(a),$(".inputhouse").val(""),$(".inputhouse").removeAttr("param-key").removeAttr("data-key")}})}})};$("input.inputhouse").keyup(function(){a($(this).val())});var b=function(a){for(var b=a.buildname,c=a.buildnickname,d=a.buildid,e=a.citydomain,f=$("#newhouse_afterdomain").val(),g=c+"."+e+"."+f,h=[],i=0;i<builddata.length;i++)h.push(builddata[i].buildid);if($(".houselistbox .houselistitem .buildid").each(function(a,b){h.push($(this).val())}),$(".houselistitem").size()>=3)tool.showMsg("error","最多允许添加三条楼盘信息！");else if($.inArray(d,h)>=0)tool.showMsg("error","已选择该楼盘！");else{var j='<li class="houselistitem"><div class="housetitle"><i class="checkallicon"></i><span class="checktext">'+b+'</span><input type="hidden" value='+d+' class="buildid" /><input type="hidden" value='+c+' class="buildnick" /><input type="hidden" value='+e+' class="citydomainCls" /><i class="delicon"></i></div><ul><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">详情</span><input type="hidden" value="http://'+g+'/detail.html"></li><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">相册</span><input type="hidden" value="http://'+g+'/album"></li><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">户型</span><input type="hidden" value="http://'+g+'/housetype"></li><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">资讯</span><input type="hidden" value="http://'+g+'/news"></li><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">周边地图</span><input type="hidden" value="http://'+g+'/#round_map_id"></li></ul></li>';$(".houselistbox").append(j);var k=$(".ui-dialog.insert").parent().height();$(".ui-dialog.insert").parent().css("top",($(window).height()-k)/2-30+"px")}}},updatebuild:function(){dialog({width:370,id:"updatebuild",backdropOpacity:.1,skin:"updatebuild",title:"修改插入楼盘信息",content:'<ul class="houselistbox"></ul><input type="hidden" class="houseindex" />',lock:!0,fixed:!0,ok:function(){var a=$("input.houseindex").val();if(0==$(".houselistbox .houselistitem").find(".checked").length)builddata.splice(a,1),$(".buildinsertbox .buildinfo").eq(a).remove(),tool.showMsg("success","已成功删除该楼盘信息！");else{var b=builddata[a],c="";b.buildname="",b.view="",b.album="",b.unit="",b.bibi="",b.map="",$(".houselistitem .housetitle .checkallicon").hasClass("checked")&&(b.buildname=$(".houselistitem .housetitle").text(),c+='<li class="buildbtnlist buildname">  <span title='+b.buildname+">"+b.buildname+'</span>  <i class="deleteicon"></i></li>');var d=b.nickname+"."+b.citydomain+"."+$("#newhouse_afterdomain").val();$(".houseinfoitems").each(function(){if($(this).find(".checked").length>0)switch($(this).index()){case 0:b.view="http://"+d+"/detail.html",c+='<li class="buildbtnlist view">  <span>详情</span>  <i class="deleteicon"></i></li>';break;case 1:b.album="http://"+d+"/album",c+='<li class="buildbtnlist album">  <span>相册</span>  <i class="deleteicon"></i></li>';break;case 2:b.unit="http://"+d+"/housetype",c+='<li class="buildbtnlist unit">  <span>户型</span>  <i class="deleteicon"></i></li>';break;case 3:b.bibi="http://"+d+"/news",c+='<li class="buildbtnlist bibi">  <span>资讯</span>  <i class="deleteicon"></i></li>';break;case 4:b.map="http://"+d+"/#nearMap",c+='<li class="buildbtnlist map">  <span>周边地图</span>  <i class="deleteicon"></i></li>'}}),$(".buildinsertbox .buildinfo").eq(a).find(".buildbtnbox").empty().append(c)}},okValue:"修改"}).showModal()},showUpdateHouses:function(a){if($(".buildinsertbox").html(""),null!=a&&a instanceof Array){builddata=a;for(var b=0;b<a.length;b++){var c="",d=a[b];c+='<li class="buildinfo"><div class="estatedetailinfo"><span class="estatetital">'+d.house_name+'</span></div><ul class="buildbtnbox">',""!=d.buildname&&(c+='<li class="buildbtnlist buildname"><span title='+d.buildname+">"+d.buildname+'</span><i class="deleteicon"></i></li>'),""!=d.view&&(c+='<li class="buildbtnlist view"><span>详情</span><i class="deleteicon"></i></li>'),""!=d.album&&(c+='<li class="buildbtnlist album"><span>相册</span><i class="deleteicon"></i></li>'),""!=d.unit&&(c+='<li class="buildbtnlist unit"><span>户型</span><i class="deleteicon"></i></li>'),""!=d.bibi&&(c+='<li class="buildbtnlist bibi"><span>资讯</span><i class="deleteicon"></i></li>'),""!=d.map&&(c+='<li class="buildbtnlist map"><span>周边地图</span><i class="deleteicon"></i></li>'),c+="</ul></li>",$(".buildinsertbox").append(c)}}},startend:function(){dialog({width:370,id:"startend",skin:"startend",title:"时间区域选择",content:'<div class="choosebox chooseplate f-l">  <span class="choosetitle plate">开始时间</span>  <span>:</span>  <input type="text" class="startdate" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择开始时间" /></div><div class="choosebox choosetips f-r">  <span class="choosetitle tips">结束时间</span>  <span>:</span>  <input type="text" class="enddate" onfocus="WdatePicker({minDate:\'%y-%M-%d\'})" readOnly placeholder="选择结束时间" /></div>',lock:!0,fixed:!0,ok:function(){var a=$(".startdate").val(),b=$(".enddate").val(),c=function(a){return Date.parse(new Date(a))};return console.log(c(a)),console.log(c(b)),c(a)>=c(b)&&tool.showMsg("error","开始时间不能晚于结束时间！"),!1},okValue:"搜索"}).show()}};$(function(){$(".moderatorbtn .adddigest").click(function(){var a=$(this).parents(".postcontent").attr("tid");$.get(BASE_URL+"/post/getDateFromTheme?action_type=-1&target_type=0&this_tid="+a).success(function(a){dialogbtn.reward(a)})}),$("body").on("click",".reward .select",function(a){a.stopPropagation(),$(this).next().toggle(),$(this).closest(".selectlistbox").siblings().find(".selectlist").each(function(a,b){"none"!=$(this).css("display")&&$(this).hide()})}),$("body").on("click",".reward .selectlist li",function(){$(this).parent().prev().find(".content").text($(this).text()),$(this).parent().hide()}),$(document).click(function(){$(".selectlist").each(function(){"none"!=$(this).css("display")&&$(this).hide()})}),$("body").on("click","li.firstlevel span",function(){var a=$(this).text();if(console.log(a),"selectlist1"==$(this).parent().parent().attr("id")){var b="",c=encodeURI(a),d=BASE_URL+"/post/getbannerlist?selecttext="+c;$.get(d).success(function(a){for(var c in a)for(var d=0;d<a[c].length;d++)b+='<li class="firstlevel">  <span>'+a[c][d].title+"</span></li>";$("#selectlist2").empty(),$("#selectlist2").append(b)}).error(function(){console.log("error~~~~~~~")}),$(this).closest(".ui-dialog-content").find(".adname").text("请选择")}if("selectlist3"==$(this).parent().parent().attr("id")){var c=encodeURI(a),d=BASE_URL+"/post/getlaberlist?selecttext="+c;$.get(d).success(function(a){var b="";for(var c in a)for(var d=0;d<a[c].length;d++)b+='<li class="firstlevel">  <span>'+a[c][d].name+"</span></li>";$("#selectlist4").empty(),$("#selectlist4").append(b)}),
$(this).closest(".ui-dialog-content").find(".tipsname").text("请选择")}$(this).closest(".choosebox").find(".selecttext").text(a)}),$("body").on("click",".secondlevel li",function(a){var b=$(this).text();if(console.log(b),"selectlist1"==$(this).parent().parent().parent().attr("id")){var c=encodeURI(b),d=BASE_URL+"/post/getbannerlist?selecttext="+c;$.get(d).success(function(a){var b="";for(var c in a)for(var d=0;d<a[c].length;d++)b+='<li class="firstlevel">  <span>'+a[c][d].title+"</span></li>";$("#selectlist2").empty(),$("#selectlist2").append(b)}),$(this).closest(".ui-dialog-content").find(".adname").text("请选择")}if("selectlist3"==$(this).parent().parent().parent().attr("id")){var c=encodeURI(b),d=BASE_URL+"/post/getlaberlist?selecttext="+c;$.get(d).success(function(a){var b="";for(var c in a)for(var d=0;d<a[c].length;d++)b+='<li class="firstlevel">  <span>'+a[c][d].name+"</span></li>";$("#selectlist4").empty(),$("#selectlist4").append(b)}),$(this).closest(".ui-dialog-content").find(".tipsname").text("请选择")}$(this).closest(".choosebox").find(".selecttext").text(b)}),$(".moderatorbtn .transfer").click(function(){var a=$(this).parents(".postcontent").attr("tid");$.get(BASE_URL+"/post/getThemeCategory?this_tid="+a).success(function(a){dialogbtn.transfer(a)})}),$(".nrecommend").click(function(){var a=$(this);checkLoginFun(function(){var b=a.parents(".postcontent").attr("tid");$.get(BASE_URL+"/post/tomoderator/"+b).success(function(){tool.showMsg("success","已推荐给版主！"),$(".nrecommend").before(' <span class="btn-posthead btn-hover recommend" >推荐成功</span>'),$(".nrecommend").remove()})})}),$(".moderatorbtn .updown").click(function(){var a=$(this).parents(".postcontent").attr("tid");$.get(BASE_URL+"/post/getDateFromTheme?action_type=1&target_type=0&this_tid="+a).success(function(a){dialogbtn.updown(a)})}),$(".moderatorbtn .forbidden").click(function(){var a=$(this).parents(".postcontent").attr("tid");$.get(BASE_URL+"/post/getDateFromTheme?action_type=0&target_type=0&this_tid="+a).success(function(a){dialogbtn.forbidden(a)})}),$(".action-shutup").click(function(){var a=$(this).parents(".postcontent").attr("pid");$.get(BASE_URL+"/post/getDateFromTheme?action_type=11&target_type=1&this_tid="+a).success(function(b){dialogbtn.shutup(a,0,b)})}),$("body").on("click",".comment-shutup",function(){var a=$(this).parents(".floorcontent").find(".floorcontenttext").attr("comment_id"),b=$(this).closest(".postcontent").attr("pid");$.get(BASE_URL+"/post/getDateFromTheme?action_type=11&target_type=2&this_tid="+a).success(function(c){dialogbtn.shutup(b,a,c)})}),$(".action-shield").click(function(){var a=$(this).parents(".postcontent").attr("pid");$.get(BASE_URL+"/post/getDateFromTheme?action_type=2&target_type=1&this_tid="+a).success(function(b){dialogbtn.shield(a,0,b)})}),$("body").on("click",".comment-shield",function(){var a=$(this).parents(".floorcontent").find(".floorcontenttext").attr("comment_id"),b=$(this).closest(".postcontent").attr("pid");$.get(BASE_URL+"/post/getDateFromTheme?action_type=2&target_type=2&this_tid="+a).success(function(c){dialogbtn.shield(b,a,c)})}),$(".jbrepost").click(function(){var a=$(this);checkLoginFun(function(){var b=a.parents(".postcontent").attr("pid");dialogbtn.informant(b,0)})}),$("body").on("click",".jbcomments",function(){var a=$(this);checkLoginFun(function(){var b=a.parents(".floorcontent").find(".floorcontenttext").attr("comment_id");dialogbtn.informant(0,b)})}),$(".moderatorbtn .push").click(function(){var a=$(this).parents(".postcontent").attr("tid");$.get(BASE_URL+"/post/getforumlist?this_tid="+a).success(function(a){dialogbtn.push(a)})}),$(".moderatorbtn .delete").click(function(){var a=$(this).parents(".postcontent").attr("pid");dialogbtn.deletepost(a,0,"postcontent0")}),$(".action-delete").click(function(){var a=$(this).parents(".postcontent").attr("pid");dialogbtn.deletepost(a,0,$(this).parents(".postcontent").find(".floor").attr("name"))}),$("body").on("click",".comment-delete",function(){var a=$(this).parents(".floorcontent").find(".floorcontenttext").attr("comment_id"),b=$(this).closest(".postcontent").attr("pid");dialogbtn.deletepost(b,a,0)}),$(".attention .done").click(function(){var a=$(this);checkLoginFun(function(){var b=a.attr("uid");$.get(BASE_URL+"/post/mfriend/"+b).success(function(a){tool.showMsg("success",a),$(".done").before(' <span class="payattention" disabled="disabled"><em></em>已加好友</span>'),$(".done").remove()})})}),$(".moderatorbtn .pass").click(function(){console.log("click pass"),tool.confirm("是否确认通过？",function(){var a=$(".repostauthorid").val(),b=$(".reposttid").val(),c=$(".repostfid").val(),d=$(".repostpid").val(),e={authorid:a,fid:c,pid:d,tid:b,targetType:0,actionType:7};tool.ajax(BASE_URL+"/post/passpost","get",e,function(){tool.showMsg("success","该贴已通过！"),window.location.reload()})})}),$(".moderatorbtn .nopass").click(function(){tool.confirm("是否确认不通过？",function(){var a=$(".repostauthorid").val(),b=$(".reposttid").val(),c=$(".repostfid").val(),d=$(".repostpid").val(),e={authorid:a,fid:c,pid:d,tid:b,targetType:0,actionType:8};tool.ajax(BASE_URL+"/post/passpost","get",e,function(){tool.showMsg("success","该贴不通过！"),window.location.reload()})})})});var forumposts={votepost:function(){var a=0;$(".star i").click(function(){var b=$(this);checkLoginFun(function(){b.unbind("click");var c=$(".repostauthorid").val(),d=$(".reposttid").val(),e=$(".repostheadimgurl").val(),f=$(".author").val(),g=$(".starnum .leval").text(),h={tid:d,starnum:g,author:f,authorid:c,headimgurl:e};0==a&&(a=1,$.post(BASE_URL+"/post/setStars",h).success(function(b){if("alreadyReward"==b)return tool.showMsg("error","您已经赏过星了，请刷新页面！"),void(a=0);$(".unaward").remove(),$(".awardstar").append('<div class="awarded star'+g+'"></div>'),$(".awarddetail").show(),$(".awarddetail").find("li.usercase").size()>=10?$(".awarddetail").find(".showmore").show():$(".awarddetail").find(".showmore").hide();var c=$("#currentLoginUserHeadImg").val(),d=$("#currentLoginUserNickName").val(),e=$("#static_files_url_htn").val(),f='<li class="usercase"><img src="'+c+'" alt="" onerror="this.src=\''+e+"/images/default-user.png'\" />";f+='<span class="user-name" title="'+d+'">'+d+"</span>",f+='<span class="eachstarnum"><span>'+g+'</span><i class="staricon"></i></span><i class="user-pic-over"></i></li>',$(".awarddetail ul").prepend(f);var h=0;h=""!=$.trim($(".totalstarnum").text())?parseInt($(".totalstarnum").text())+parseInt(g):g,$(".totalstarnum").text(h)}))})}),$(".replysubmit").click(function(){var a=$(this).siblings(".isclosd").val(),b=$(this).siblings(".ispassed").val();if(0!=a)return void tool.showMsg("error","禁评贴不能回复 ！");if(1!=b)return void tool.showMsg("error","未通过不能回复！");var c=$(this).parent().prev(".editarea").val();if(c=c.replace(/\s+/g,""),0==c.length)return void tool.showMsg("error","请输入内容！");var d=0;if($.ajax({url:BASE_URL+"/post/isMemberFobid",type:"GET",async:!1,success:function(a){1==a&&(d=1)}}),1==d)return void tool.showMsg("info","您已被禁言!");var e=$(this).parent().parent().siblings(".replylists"),f=$(this).parent().prev(".editarea").val();f=f.replace(/</g,"&lt;").replace(/>/g,"&gt;");var g=$(this).siblings(".userId").val(),h=$(this).siblings(".postpid").val(),i=$(this).siblings(".posttid").val(),j=$(this).siblings(".authorname").val(),k=$(this).siblings(".author").val(),l=$(this).parent().prev(".editarea").attr("re_comment_rcid"),m=$(this).parent().prev(".editarea").attr("re_comment_userid");j||(m=$(this).closest(".postcontent").find(".post-content").attr("thisPostUserId")),$(this).parent().prev(".editarea").attr("re_comment_rcid","").attr("re_comment_userid","");var n=$(this),o=0,p={tid:i,pid:h,content:f,author:k,authorid:g,authorname:j,re_comment_rcid:l,re_comment_userid:m};if(f){var q="回复 "+k+" ：",c=$.trim(f.replace(q,""));""==c?(tool.showMsg("error","回复内容不能为空！"),o=1):o=0}else tool.showMsg("error","回复内容不能为空！"),o=1;0!=o||$(this).is("[disabled]")||($(this).attr("disabled","disabled"),$.post(BASE_URL+"/post/savePostComment",p).success(function(a){for(var b=$.parseJSON(a),c="",d=0;d<b.commentList.length;d++){var f=b.commentList[d],g=f.gmtModified;if(g=g.replace("-","/").replace("-","/"),""==f.authorname){c+='<li class="replyitem"><img src="'+f.headimgurl+'" alt="" class="replyuserpic f-l">',c+='<div class="f-r floorcontent"><div class="floorcontenttext" comment_id="'+f.cid+'"><span class="username" re_from_userid="'+f.authorid+'">'+f.author+"</span>",c+="</span><span> 回复 : </span>","1"==f.isdelete||"1"==f.shield?(c+='<span class="shielding"><i class="img"></i>',c+="<span>该回复出现敏感词已被屏蔽或删除</span></span>"):c+=f.content,c+='</div><div class="floorfoot">';var h=$("#rewardpower").val();"0"!=f.isdelete||!h||-1==h.indexOf("allowdelpost")&&-1==h.indexOf("allowbanpost")&&-1==h.indexOf("allowbanuser")||(c+='<span class="action footbtn"><span class="btn-action">操作</span><ul class="action-btn">',-1!=h.indexOf("allowdelpost")&&(c+='<li class="comment-delete">删除</li>'),-1!=h.indexOf("allowbanpost")&&(c+='<li class="comment-shield">屏蔽</li>'),-1!=h.indexOf("allowbanuser")&&(c+='<li class="comment-shutup">禁言</li>'),c+="</ul></span>"),c+='<span class="report jbcomments">举报</span><span class="replytime">'+new Date(g).format("yyyy-MM-dd hh:mm")+"</span>",c+="0"==f.isdelete?'<span class="floorinreply">回复</span>':"",c+="</div></div></li>"}else{c+='<li class="replyitem"><img src="'+f.headimgurl+'" alt="" class="replyuserpic f-l">',c+='<div class="f-r floorcontent"><div class="floorcontenttext" comment_id="'+f.cid+'"><span class="username" re_from_userid="'+f.authorid+'">'+f.author+"</span>",c+='<span class="replyname"> 回复 </span><span class="username">'+f.authorname+"</span><span>: </span>","1"==f.isdelete||"1"==f.shield?(c+='<span class="shielding"><i class="img"></i>',c+="<span>该回复出现敏感词已被屏蔽或删除</span></span>"):c+=f.content,c+='</div><div class="floorfoot">';var h=$("#rewardpower").val();"0"!=f.isdelete||!h||-1==h.indexOf("allowdelpost")&&-1==h.indexOf("allowbanpost")&&-1==h.indexOf("allowbanuser")||(c+='<span class="action footbtn"><span class="btn-action">操作</span><ul class="action-btn">',-1!=h.indexOf("allowdelpost")&&(c+='<li class="comment-delete">删除</li>'),-1!=h.indexOf("allowbanpost")&&(c+='<li class="comment-shield">屏蔽</li>'),-1!=h.indexOf("allowbanuser")&&(c+='<li class="comment-shutup">禁言</li>'),c+="</ul></span>"),c+='<span class="report jbcomments">举报</span><span class="replytime">'+new Date(g).format("yyyy-MM-dd hh:mm")+"</span>",c+="0"==f.isdelete?'<span class="floorinreply">回复</span>':"",c+="</div></div></li>"}}e.html(c),n.closest(".replyedit").prev().find(".replyfloorbtn").stop(!0,!0).toggleClass("gray"),n.parent().prev(".editarea").val(""),n.closest(".replyedit").stop(!0,!0).slideToggle(),n.closest(".replyedit").prev().show(),e.next().find("ul.page").attr("data-cur",1),e.next().find("ul.page").attr("data-count",b.totalPages),createPage(e.next().find("ul.page")),n.removeAttr("disabled")}).error(function(){n.removeAttr("disabled")}))}),$(".commentPageDiv .page").click(function(){var a=$(this).attr("data-cur"),b=$(this).parents(".postcontent").attr("pid"),c=$(this).parent().prev();$.ajax({url:BASE_URL+"/post/getPostCommentList",type:"GET",data:{pid:b,curpage:a},success:function(a){for(var b=$.parseJSON(a),d="",e=0;e<b.commentList.length;e++){var f=b.commentList[e],g=f.gmtModified;if(g=g.replace("-","/").replace("-","/"),g=new Date(g).format("yyyy-MM-dd hh:mm"),""==f.authorname){d+='<li class="replyitem"><img src="'+f.headimgurl+'" alt="" class="replyuserpic f-l">',d+='<div class="f-r floorcontent"><div class="floorcontenttext" comment_id="'+f.cid+'"><span class="username" re_from_userid="'+f.authorid+'">'+f.author+"</span>",d+="</span><span> 回复 : </span>","1"==f.isdelete||"1"==f.shield?(d+='<span class="shielding"><i class="img"></i>',d+="<span>该回复出现敏感词已被屏蔽或删除</span></span>"):d+=f.content,d+='</div><div class="floorfoot">';var h=$("#rewardpower").val();"0"!=f.isdelete||!h||-1==h.indexOf("allowdelpost")&&-1==h.indexOf("allowbanpost")&&-1==h.indexOf("allowbanuser")||(d+='<span class="action footbtn"><span class="btn-action">操作</span><ul class="action-btn">',-1!=h.indexOf("allowdelpost")&&(d+='<li class="comment-delete">删除</li>'),-1!=h.indexOf("allowbanpost")&&(d+='<li class="comment-shield">屏蔽</li>'),-1!=h.indexOf("allowbanuser")&&(d+='<li class="comment-shutup">禁言</li>'),d+="</ul></span>"),d+='<span class="report jbcomments">举报</span><span class="replytime">'+g+"</span>",d+="0"==f.isdelete?'<span class="floorinreply">回复</span>':"",d+="</div></div></li>"}else{d+='<li class="replyitem"><img src="'+f.headimgurl+'" alt="" class="replyuserpic f-l">',d+='<div class="f-r floorcontent"><div class="floorcontenttext" comment_id="'+f.cid+'"><span class="username" re_from_userid="'+f.authorid+'">'+f.author+"</span>",d+='<span class="replyname"> 回复 </span><span class="username">'+f.authorname+"</span><span>: </span>","1"==f.isdelete||"1"==f.shield?(d+='<span class="shielding"><i class="img"></i>',d+="<span>该回复出现敏感词已被屏蔽或删除</span></span>"):d+=f.content,d+='</div><div class="floorfoot">';var h=$("#rewardpower").val();"0"!=f.isdelete||!h||-1==h.indexOf("allowdelpost")&&-1==h.indexOf("allowbanpost")&&-1==h.indexOf("allowbanuser")||(d+='<span class="action footbtn"><span class="btn-action">操作</span><ul class="action-btn">',-1!=h.indexOf("allowdelpost")&&(d+='<li class="comment-delete">删除</li>'),-1!=h.indexOf("allowbanpost")&&(d+='<li class="comment-shield">屏蔽</li>'),-1!=h.indexOf("allowbanuser")&&(d+='<li class="comment-shutup">禁言</li>'),d+="</ul></span>"),d+='<span class="report jbcomments">举报</span><span class="replytime">'+g+"</span>",d+="0"==f.isdelete?'<span class="floorinreply">回复</span>':"",d+="</div></div></li>"}}c.html(d)}})}),$(".submitbtn").click(function(){var a=$(this),b=a.html(),a=$(this);checkLoginFun(function(){if($(".edit-pid").val()){var c=ue.getContentTxt();c=c.substring(0,50);var d={tid:$(".reposttid").val(),pid:$(".edit-pid").val(),floor:$(".edit-pid").attr("floor"),content:ue.getContent(),fanginfo:JSON.stringify(builddata),summary:c};ue.ready(function(){if(ue.hasContents()){var c=ue.getContent();if(c=c.replace(/\s+/g,""),0==c.length)return void tool.showMsg("info","请输入文本内容!");a.is("[disabled]")||(a.attr("disabled","disabled"),$.ajax({url:BASE_URL+"/post/editPost",type:"POST",data:d,beforeSend:function(){a.html("提交中..."),a.attr("disabled","disabled")},complete:function(){a.html(b)},success:function(b){if(0==b.code){tool.showMsg("success","保存成功！"),$(".buildinsertbox").html(""),builddata=[],$(".postcontent").each(function(a,c){if($(this).attr("pid")==$(".edit-pid").val()){var d=$(this).attr("pid");if($(this).find(".post-content").html(b.data),$(this).find(".insertHouseCls").val(b.fanginfo),$('.insertHouseCls[pid="'+d+'"]').nextAll().remove(),null!=b.fanginfo&&""!=b.fanginfo)for(var e=$.parseJSON(b.fanginfo),f=0;f<e.length;f++){var g=e[f];if(""==g.buildname){var h=appendbuild(null,g);$('.insertHouseCls[pid="'+d+'"]').parent().append(h)}else!function(a){var b=$("#homenhApiRouterRest").val(),c={requrl:b,bid:a.buildid};tool.ajaxJsonp("homenhapi.newhouse.getNewHouseInfoByBid","get",c,function(b,c){if(b[c]&&b[c].data){var e=b[c].data,f=appendbuild(e,a);$('.insertHouseCls[pid="'+d+'"]').parent().append(f)}else console.log("请求出现错误》 homenhapi.newhouse.getNewHouseInfoByBid 》"+b)})}(g)}}});var c=window.location.href.split("#")[0];window.location.href=c+"#"+$(".edit-pid").val(),$("."+d.pid).val(d.content),ue.setContent(""),$(".edit-pid").val(""),a.removeAttr("disabled")}else if(1==b.code)return tool.showMsg("error",b.msg),void a.removeAttr("disabled")},error:function(b){tool.showMsg("error",b),a.removeAttr("disabled")}}))}else tool.showMsg("info","请输入文本内容!")})}else{var c=ue.getContentTxt();c=c.substring(0,50);var d={fid:a.siblings(".repostfid").val(),tid:a.siblings(".reposttid").val(),author:a.siblings(".repostauthor").val(),authorid:a.siblings(".repostauthorid").val(),headimgurl:a.siblings(".repostheadimgurl").val(),useip:a.siblings(".repostuseip").val(),source:a.siblings(".repostsource").val(),content:ue.getContent(),fanginfo:JSON.stringify(builddata),summary:c};ue.ready(function(){if(ue.hasContents()){if(-1!=d.content.indexOf("/themes/default/images/spacer.gif"))return void tool.showMsg("error","图片未加载完，请等图片加载完之后再发！");a.is("[disabled]")||(a.attr("disabled","disabled"),$.ajax({url:BASE_URL+"/post/sendReply",type:"POST",data:d,beforeSend:function(){a.html("提交中..."),a.attr("disabled","disabled")},complete:function(){a.html(b)},success:function(b){if("success"==b.resultCode)tool.showMsg("success","回贴成功！",function(){var c=function(){var c=a.siblings(".reposttid").val(),d=b.lastPageNo,e=b.ownPageFloor,f=decodeURIComponent(window.location.href);f.indexOf("/thread-")>-1&&(f=f.substring(0,f.lastIndexOf("/")),window.location.href=f+"/thread-"+c+"-"+d+"-1.html#postcontent"+e),f.indexOf("/houseqa-")>-1&&(f=f.substring(0,f.lastIndexOf("/")),window.location.href=f+"/houseqa-"+c+"-"+d+"-1.html#postcontent"+e),window.location.href.split("-")[2]==d&&window.location.reload()};1==b.scoreModifyMap.code?tool.showMsg("success",b.scoreModifyMap.resultMsg,function(){""!=b.scoreModifyMap2?tool.showMsg("success",b.scoreModifyMap2.resultMsg,function(){c()},2e3):c()},1e3):c()});else if("error"==b.resultCode)return tool.showMsg("error",b.msg,null,1e3),void a.removeAttr("disabled")},error:function(b){a.removeAttr("disabled")}}))}else tool.showMsg("info","请输入文本内容！")})}})}),$(".vote-btn .posthead-right").click(function(){var a=$(this),b=a.html();checkLoginFun(function(){var c=new Date,d=$(".votingEndTime").val()+" 23:59:59";if(new Date(Date.parse(d))<c)return void tool.showMsg("error","已超过投票截止日期！");for(var e=a.parent(".vote-btn").siblings(".votelistbox").find(".active .text"),f="",g=0;g<e.length;g++)f=0==g?$(e[g]).text():f+";"+$(e[g]).text();f=encodeURIComponent(f);var h=$(".repostauthorid").val(),i=$(".reposttid").val(),j=$(".repostauthor").val(),k=BASE_URL+"/sns/setvote?tid="+i+"&options="+f+"&author="+j+"&authorid="+h;if(console.log("options:"+f),""==f)return void tool.showMsg("error","请选择投票项！");$.ajax({type:"post",url:k,async:!1,beforeSend:function(){a.html("投票中..."),a.attr("disabled","disabled")},complete:function(){a.html(b)},success:function(a){if(0==a.code){tool.showMsg("success","投票成功");var b='<div class="voteresultbox"><div class="text">投票结果</div>';b+='<ul class="voteresultlist"></ul></div>',$(".votepostbox").before(b),$(".votepostbox").remove();var c=$.parseJSON(a.voteMap.votingOptions),d=a.optionslist,e=a.optionspercentlist;showVoteResultFun(c,d,e),$(".awarddetail").show(),$(".awarddetail").find("li.usercase").size()>=10?$(".awarddetail").find(".showmore").show():$(".awarddetail").find(".showmore").hide();var f=$("#currentLoginUserHeadImg").val(),g=$("#currentLoginUserNickName").val(),h=$("#currentLoginUserId").val(),i=$("#static_files_url_htn").val(),j='<li class="usercase" authorid="'+h+'"><img src="'+f+'" alt="" onerror="this.src=\''+i+"/images/default-user.png'\" />";j+='<span class="user-name" title="'+g+'">'+g+"</span>",j+='<i class="user-pic-over"></i></li>',$(".awarddetail ul").prepend(j);var k=parseInt($(".totalvotenum").text())+1;$(".totalvotenum").text(k);var l=["#99CBEE","#99EFCF","#97F2FF","#CCF380","#D09DFF","#FB8A9C","#FFAEDA","#FDA88E","#C780B7","#3CCFBB","#C5D652","#FEF96D","#C49B83","#E9B88B","#FFC851","#F26B5D"],m=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P"];$(".votelistbox,.voteresultlist").each(function(){$(this).find("li").each(function(a,b){$(b).find(".index").text(m[a]).css("background-color",l[a]),$(b).find(".rate").css("background-color",l[a])})}),$(".voteresultlist .rate").each(function(){$(this).width(606*$(this).attr("count")+"px")})}else 2==a.code?tool.showMsg("error","已投票,请刷新页面"):console.log("后端异常")}})})})}};$(function(){insertHouseToHtml=function(a){for(var b=0;b<a.length;b++){var c=a[b],d="";d+='<li class="buildinfo">  <div class="estatedetailinfo">    <span class="estatetital">'+c.house_name+'</span>  </div>  <ul class="buildbtnbox">',c.buildname&&(d+='<li class="buildbtnlist buildname">  <span title='+c.buildname+">"+c.buildname+'</span>  <i class="deleteicon"></i></li>'),c.view&&(d+='<li class="buildbtnlist view">  <span>详情</span>  <i class="deleteicon"></i></li>'),c.album&&(d+='<li class="buildbtnlist album">  <span>相册</span>  <i class="deleteicon"></i></li>'),c.unit&&(d+='<li class="buildbtnlist unit">  <span>户型</span>  <i class="deleteicon"></i></li>'),c.bibi&&(d+='<li class="buildbtnlist bibi">  <span>资讯</span>  <i class="deleteicon"></i></li>'),c.map&&(d+='<li class="buildbtnlist map">  <span>周边地图</span>  <i class="deleteicon"></i></li>'),d+="</ul></li>",$(".buildinsertbox").append(d)}},appendbuild=function(a,b){var c='<div data-test="'+b.buildid+'" class="estatedetailinfo"><span class="estatetital">推荐你看一下<span class="estatename" style="margin-left:5px;">'+b.house_name+"</span></span></div>";if(""!=b.buildname&&a){var d=a.ImageUrl?a.ImageUrl:"../images/20087584237954_2.jpg",e=null==a.LastActive?"":a.LastActive,f="";if(f=a.Avegprice&&0!=a.Avegprice&&"0"!=a.Avegprice?'<span class="red">￥</span><span class="red striking">'+a.Avegprice+"</span><span>元/m²</span>":'<span class="red striking">待定</span>',c+='<div class="buildcontent" style="width:550px;padding-left:50px;padding-right:50px;" id="'+a.BuildNickName+'"><div class="buildimgbox f-l"><a href='+a.LinkUrl+' class="" target="_blank"><img src='+d+' alt=""></a></div><div class="buildinfobox f-l cf" style="width:306px;"><div class="buildtitle"><a href='+a.LinkUrl+' target="_blank" class="buildname">'+a.BuildName+"</a>"+f+'</div><div class="coupon">'+e+'</div><div class="housetype"><span class="housetypetitle f-l">热销户型：</span>',a.arealist&&a.arealist.length>0)if(a.arealist.length<2)c+='<ul class="arrow f-l cf"><li><a href="'+a.arealist[0].link+'" target="_blank">'+a.arealist[0].name+'</a></li></ul><ul class="houselist cf">';else{c+='<ul class="arrow f-l cf" style="margin-right:6px;"><li><a href="'+a.arealist[0].link+'" target="_blank">'+a.arealist[0].name+'</a></li><li><a href="'+a.arealist[1].link+'" target="_blank">'+a.arealist[1].name+'</a></li></ul><ul class="houselist cf">';for(var g=0;g<a.arealist.length;g++)c+='<li><a href="'+a.arealist[g].link+'" target="_blank">'+a.arealist[g].name+"</a></li>"}c+='</ul></div><div class="address"><span>地址：</span><span class="houseaddr" style="width:252px;">'+a.Address+"</span></div></div></div>"}return b.buildid&&(c+='<ul class="buildbtns">',""!=b.view&&(c+='<li class="buildbtn"><a href="'+b.view+'" target="_blank"><span class="btnsicon"><i class="detaiicon"></i></span><span class="icondes">楼盘详情</span></a></li>'),""!=b.album&&(c+='<li class="buildbtn"><a href="'+b.album+'" target="_blank"><span class="btnsicon"><i class="photoicon"></i></span><span class="icondes">相册</span></a></li>'),""!=b.unit&&(c+='<li class="buildbtn"><a href="'+b.unit+'" target="_blank"><span class="btnsicon"><i class="typeicon"></i></span><span class="icondes">户型</span></a></li>'),""!=b.bibi&&(c+='<li class="buildbtn"><a href="'+b.bibi+'" target="_blank"><span class="btnsicon"><i class="costperforicon"></i></span><span class="icondes">资讯</span></a></li>'),""!=b.map&&(c+='<li class="buildbtn"><a href="'+b.map+'" target="_blank"><span class="btnsicon"><i class="mapicon"></i></span><span class="icondes">周边地图</span></a></li>'),c+="</ul>"),c},$(".insertHouseCls").each(function(){var a=$(this).attr("pid"),b=$(this).val();if(""!=b)for(var c=$.parseJSON(b),d=0;d<c.length;d++){var e=c[d];if(""==e.buildname){var f=appendbuild(null,e);$('.insertHouseCls[pid="'+a+'"]').parent().append(f)}else!function(b){var c=$("#homenhApiRouterRest").val(),d={requrl:c,bid:b.buildid};tool.ajaxJsonp("homenhapi.newhouse.getNewHouseInfoByBid","get",d,function(c,d){if(c[d]&&c[d].data){var e=c[d].data,f=appendbuild(e,b);$('.insertHouseCls[pid="'+a+'"]').parent().append(f)}else console.log("请求出现错误》 homenhapi.newhouse.getNewHouseInfoByBid 》"+c)})}(e)}}),$("body").on("click",".checkicon,.checktext",function(){var a=$(this).parent().find(".checkicon");a.hasClass("checked")?a.removeClass("checked"):(a.addClass("checked"),a.parent().siblings().find(".checkicon").removeClass("checked")),$(".informant .other")&&($(".informant .other").prev().hasClass("checked")?$(".informanttext").removeAttr("disabled").focus():$(".informanttext").attr("disabled","disabled"))}),$("body").on("click",".checkallicon,.checkalltext,.checktext",function(){var a=$(this).parent().find(".checkallicon");a.hasClass("checked")?a.removeClass("checked"):a.addClass("checked")}),$("body").on("click",".commonreason",function(){$.get(BASE_URL+"/post/getcommonreason").success(function(a){for(var b="<ul class='reasonlist'>",c=0;c<a.CommonReasonList.length;c++)console.log(a.CommonReasonList[c].reason),b+=" <li><i class='checkicon'></i><span class='checktext'>"+a.CommonReasonList[c].reason+"</span><i class='delicon'></i></li>";b+="</ul><div class='addreason'> <input type='text' class='reasontext'><span class='addicon'></span></div>",dialogbtn.reason(b)})}),$("body").on("click",".addreason .addicon",function(){var a=$(this).prev().val();if($.trim(a)){if($.trim(a).length>30)return void tool.showMsg("error","理由不能超过30字");$.get(BASE_URL+"/post/addreason?val="+a).success(function(){console.log("添加成功")}),$(".reasonlist").append('<li>  <i class="checkicon"></i>  <span class="checktext">'+a+'</span>  <i class="delicon"></i></li>'),$(this).prev().val("")}else tool.showMsg("error","理由不能为空！"),$(this).prev().focus()}),$("body").on("click",".delicon",function(a){var b=$(this).closest("li").find(".checktext").text();$.get(BASE_URL+"/post/delreason?val="+b).success(function(){console.log("删除成功")}),$(this).closest("li").remove()}),$("body").on("click",".push .select,.transfer .select",function(a){a.stopPropagation(),$(this).next().toggle(),$(this).closest(".choosebox").siblings().find(".selectlist").each(function(a,b){"none"!=$(this).css("display")&&$(this).hide()})}),$("body").on("mouseover mouseout","li.firstlevel",function(a){"mouseover"==a.type?$(this).find(".secondlevel").show():"mouseout"==a.type&&$(this).find(".secondlevel").hide()}),$(".inserthouses").click(dialogbtn.insert),$("body").on("click",".deleteicon",function(){var a=$(this).closest(".buildinfo"),b=a.index(),c=$(this).parent();c.remove(),c.hasClass("buildname")?builddata[b].buildname="":c.hasClass("view")?builddata[b].view="":c.hasClass("album")?builddata[b].album="":c.hasClass("unit")?builddata[b].unit="":c.hasClass("bibi")?builddata[b].bibi="":c.hasClass("map")&&(builddata[b].map=""),0==a.find(".buildbtnlist").length&&(a.remove(),builddata.splice(b,1)),console.log(builddata)}),$("body").on("click",".buildbtnlist span",function(){dialogbtn.updatebuild(),$(".houselistbox").empty();var a=$(this).closest(".buildinfo").index(),b=builddata[a],c=$(this).closest(".buildinfo").find(".estatetital").text(),d="";$(".houseindex").val(a);var e=b.buildnick+"."+b.citydomain+"."+$("#newhouse_afterdomain").val();d+='<li class="houselistitem"><div class="housetitle"><i class="checkallicon"></i><span class="checktext">'+c+'</span><input type="hidden" value="'+b.buildid+'" class="buildid" /><input type="hidden" value="'+b.buildnick+'" class="buildnick" /><input type="hidden" value='+b.citydomain+' class="citydomainCls" /></div><ul><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">详情</span><input type="hidden" value="http://'+e+'/detail.html" /></li><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">相册</span><input type="hidden" value="http://'+e+'/album" /></li><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">户型</span><input type="hidden" value="http://'+e+'/housetype" /></li><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">资讯</span><input type="hidden" value="http://'+e+'/news" /></li><li class="houseinfoitems f-l"><i class="checkallicon"></i><span class="checkalltext">周边地图</span><input type="hidden" value="http://'+e+'/#nearMap" /></li></ul></li>',$(".houselistbox").append(d),b.buildname&&$(".houselistitem .checkallicon").eq(0).addClass("checked"),b.view&&$(".houselistitem .checkallicon").eq(1).addClass("checked"),b.album&&$(".houselistitem .checkallicon").eq(2).addClass("checked"),b.unit&&$(".houselistitem .checkallicon").eq(3).addClass("checked"),b.bibi&&$(".houselistitem .checkallicon").eq(4).addClass("checked"),b.map&&$(".houselistitem .checkallicon").eq(5).addClass("checked")}),$(".userpic").click(function(){var a=$(this).attr("authorid");if(a&&"undefined"!=a){var b=BASE_URL+"/sns/toUserRoloPage?authorid="+a;window.open(b)}})});